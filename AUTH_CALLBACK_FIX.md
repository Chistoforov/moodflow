# üîê –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å callback –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –ø–æ —Å—Å—ã–ª–∫–µ –∏–∑ email –ø–æ–ª—É—á–∞–µ—Ç–µ –æ—à–∏–±–∫—É:
```
Application error: a server-side exception has occurred while loading moodflow-six.vercel.app
```

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –û–±–Ω–æ–≤–ª–µ–Ω API route –¥–ª—è callback

–§–∞–π–ª `/src/app/api/auth/callback/route.ts` —Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞–µ—Ç:
- –ü–æ–ª–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π error handling –¥–ª—è exchangeCodeForSession
- –†–µ–¥–∏—Ä–µ–∫—Ç—ã —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –æ–± –æ—à–∏–±–∫–∞—Ö

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ª–æ–≥–∏–Ω–∞

–§–∞–π–ª `/src/app/(auth)/login/page.tsx` —Ç–µ–ø–µ—Ä—å:
- –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –æ—à–∏–±–∫–∏ –∏–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- –†–∞–∑–ª–∏—á–∞–µ—Ç —É—Å–ø–µ—à–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –æ—à–∏–±–∫–∏ –≤–∏–∑—É–∞–ª—å–Ω–æ

### 3. –û–±–Ω–æ–≤–ª–µ–Ω middleware

Middleware —Ç–µ–ø–µ—Ä—å –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç API routes –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase (–ö–†–ò–¢–ò–ß–ù–û!)

–ß—Ç–æ–±—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–ª–∞, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å Supabase:

### –®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ [supabase.com](https://supabase.com)
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Authentication ‚Üí URL Configuration**

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Site URL

```
Site URL: https://moodflow-six.vercel.app
```

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Redirect URLs

–î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ URLs –≤ –ø–æ–ª–µ **Redirect URLs** (–∫–∞–∂–¥—ã–π –Ω–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–µ):

```
https://moodflow-six.vercel.app/api/auth/callback
https://moodflow-six.vercel.app/**
http://localhost:3000/api/auth/callback
http://localhost:3000/**
```

**–í–∞–∂–Ω–æ:** 
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ—á–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å `**` –¥–ª—è wildcard
- –í–∫–ª—é—á–∏—Ç–µ localhost URLs –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–µ—Ç –æ–ø–µ—á–∞—Ç–æ–∫ –≤ –¥–æ–º–µ–Ω–µ

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Email Templates

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Authentication ‚Üí Email Templates**
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —à–∞–±–ª–æ–Ω **Magic Link** —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É:
   ```
   {{ .SiteURL }}/api/auth/callback?token_hash={{ .TokenHash }}&type=magiclink
   ```

### –®–∞–≥ 5: –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

–ù–∞–∂–º–∏—Ç–µ **Save** –∏ –ø–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥.

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Supabase:

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://moodflow-six.vercel.app/login
2. –í–≤–µ–¥–∏—Ç–µ email
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—á—Ç—É –∏ –∫–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —Å—Å—ã–ª–∫—É
4. –í—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ `/calendar`

### –ï—Å–ª–∏ –ø–æ–ª—É—á–∞–µ—Ç–µ –æ—à–∏–±–∫—É

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–ª–µ–¥—É—é—â–µ–µ:**

1. **–í Supabase Dashboard:**
   - [ ] Site URL –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
   - [ ] Redirect URLs –≤–∫–ª—é—á–∞—é—Ç `/api/auth/callback`
   - [ ] Email templates –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL

2. **–í Vercel:**
   - [ ] `NEXT_PUBLIC_SUPABASE_URL` –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
   - [ ] `NEXT_PUBLIC_SUPABASE_ANON_KEY` –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
   - [ ] `NEXT_PUBLIC_APP_URL` = `https://moodflow-six.vercel.app`

3. **–í –±—Ä–∞—É–∑–µ—Ä–µ:**
   - [ ] –û—Ç–∫—Ä–æ–π—Ç–µ Developer Tools (F12)
   - [ ] –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ Console –¥–ª—è –æ—à–∏–±–æ–∫
   - [ ] –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Network tab –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –ø–æ —Å—Å—ã–ª–∫–µ

## üìä –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫

–¢–µ–ø–µ—Ä—å —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ª–æ–≥–∏–Ω–∞ –±—É–¥–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏:

| –ü–∞—Ä–∞–º–µ—Ç—Ä URL | –°–æ–æ–±—â–µ–Ω–∏–µ | –ü—Ä–∏—á–∏–Ω–∞ |
|--------------|-----------|---------|
| `?error=auth_callback_error` | –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑. | Supabase –Ω–µ —Å–º–æ–≥ –æ–±–º–µ–Ω—è—Ç—å –∫–æ–¥ –Ω–∞ —Å–µ—Å—Å–∏—é |
| `?error=unexpected_error` | –ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞. | –ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ –≤ callback |
| `?error=no_code` | –ù–µ–≤–µ—Ä–Ω–∞—è —Å—Å—ã–ª–∫–∞ –¥–ª—è –≤—Ö–æ–¥–∞. | –í URL –Ω–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ code |
| `?error=auth_failed` | –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å. | –û–±—â–∞—è –æ—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ |

## üîÑ –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `.env.local` —Å–æ–¥–µ—Ä–∂–∏—Ç:
   ```bash
   NEXT_PUBLIC_SUPABASE_URL=https://–≤–∞—à-–ø—Ä–æ–µ–∫—Ç.supabase.co
   NEXT_PUBLIC_SUPABASE_ANON_KEY=–≤–∞—à_anon_key
   NEXT_PUBLIC_APP_URL=http://localhost:3000
   ```

2. –í Supabase –¥–æ–±–∞–≤—å—Ç–µ localhost URLs –≤ Redirect URLs (—Å–º. –®–∞–≥ 3 –≤—ã—à–µ)

3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
   ```bash
   npm run dev
   ```

## üìù –õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

Callback route —Ç–µ–ø–µ—Ä—å –ª–æ–≥–∏—Ä—É–µ—Ç –æ—à–∏–±–∫–∏. –ß—Ç–æ–±—ã –∏—Ö —É–≤–∏–¥–µ—Ç—å:

1. **–ù–∞ Vercel:**
   - Dashboard ‚Üí Project ‚Üí Functions
   - –í—ã–±–µ—Ä–∏—Ç–µ `api/auth/callback`
   - –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ Real-time Logs

2. **–õ–æ–∫–∞–ª—å–Ω–æ:**
   - –°–º–æ—Ç—Ä–∏—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª –≥–¥–µ –∑–∞–ø—É—â–µ–Ω `npm run dev`

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–ü–æ—Å–ª–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

1. ‚úÖ Magic link email –ø—Ä–∏—Ö–æ–¥–∏—Ç –Ω–∞ –ø–æ—á—Ç—É
2. ‚úÖ –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Å—Å—ã–ª–∫—É –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `moodflow-six.vercel.app`
3. ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è "–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≤—Ö–æ–¥–∞..."
4. ‚úÖ –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ `/calendar`
5. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω

## üÜò –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –∑–∞–¥–µ–ø–ª–æ–∏–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ Vercel
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Supabase –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å cookies –≤ –±—Ä–∞—É–∑–µ—Ä–µ
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∂–∏–º –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ –¥–ª—è —á–∏—Å—Ç–æ–≥–æ —Ç–µ—Å—Ç–∞
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Vercel Dashboard

---

**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 2 –Ω–æ—è–±—Ä—è 2025






