# ‚úÖ –§–ò–ù–ê–õ–¨–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –†–æ–ª—å –ê–¥–º–∏–Ω–∞

## üî¥ –ü—Ä–æ–±–ª–µ–º–∞
–ê–∫–∫–∞—É–Ω—Ç `site4people@gmail.com` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å "–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π" –≤–º–µ—Å—Ç–æ "–ê–¥–º–∏–Ω"

## ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. Backend API (`/src/app/api/admin/users/route.ts`)
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ JOIN**: —Ç–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–≤—è–∑—ã–≤–∞–µ—Ç `users.sso_uid` —Å `psychologists.user_id`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞ –∏ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –∫–æ–¥–µ
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç `effective_role` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 2. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- –î–æ–±–∞–≤–ª–µ–Ω—ã RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∑–∞–ø–∏—Å—å –∞–¥–º–∏–Ω–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ `psychologists`

## üìù –ß–¢–û –ù–£–ñ–ù–û –°–î–ï–õ–ê–¢–¨

### –®–∞–≥ 1: –í—ã–ø–æ–ª–Ω–∏—Ç—å SQL —Å–∫—Ä–∏–ø—Ç

1. –û—Ç–∫—Ä–æ–π—Ç–µ **Supabase Dashboard**: https://supabase.com/dashboard
2. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç **MoodFlow**
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **SQL Editor** (–≤ –ª–µ–≤–æ–º –º–µ–Ω—é)
4. –ù–∞–∂–º–∏—Ç–µ **New Query**
5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **–í–ï–°–¨** —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `FIX_ADMIN_ROLE_COMPLETE.sql`
6. –í—Å—Ç–∞–≤—å—Ç–µ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä
7. –ù–∞–∂–º–∏—Ç–µ **Run** (–∏–ª–∏ Cmd/Ctrl + Enter)

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

–í SQL Editor –≤—ã —É–≤–∏–¥–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:

1. **NOTICE —Å–æ–æ–±—â–µ–Ω–∏—è** - –ø–æ–∫–∞–∂—É—Ç, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç
2. **–¢–∞–±–ª–∏—Ü–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** - –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑–∞—Ç—å:
   - `psychologist_role`: `admin`
   - `psychologist_active`: `true`
   - `effective_role`: `admin`
3. **–°–ø–∏—Å–æ–∫ –ø–æ–ª–∏—Ç–∏–∫** - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤

### –®–∞–≥ 3: –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

1. –ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ - –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –µ–≥–æ:
   ```bash
   # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ (Ctrl+C)
   npm run dev
   ```

2. –ï—Å–ª–∏ –Ω–∞ Vercel - –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

1. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ (F5 –∏–ª–∏ Cmd+R)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª **"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏"**
3. –¢–µ–ø–µ—Ä—å –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
   - ‚úÖ –í–∏–¥–Ω—ã –í–°–ï –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (–≤–∫–ª—é—á–∞—è —Ç–µ—Å—Ç–æ–≤—ã—Ö)
   - ‚úÖ –£ `site4people@gmail.com` —Ä–æ–ª—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ **"–ê–¥–º–∏–Ω"**

## üîç –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–ª–∞—Å—å

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

–í—ã–ø–æ–ª–Ω–∏—Ç–µ —Ñ–∞–π–ª `DEBUG_ADMIN_ROLE.sql` –≤ SQL Editor - –æ–Ω –ø–æ–∫–∞–∂–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ:
- –ó–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `users`
- –ó–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `psychologists`
- –°–≤—è–∑—å –º–µ–∂–¥—É –Ω–∏–º–∏
- –î–∞–Ω–Ω—ã–µ –≤ `auth.users`

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **Network**
3. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
4. –ù–∞–π–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –∫ `/api/admin/users`
5. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –æ—Ç–≤–µ—Ç - —Ç–∞–º –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–µ `effective_role: "admin"`

## üìä –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤:

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 2 (–∏–ª–∏ –±–æ–ª—å—à–µ)

Email                      | –ò–º—è              | –†–æ–ª—å    | –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
---------------------------|------------------|---------|------------------
site4people@gmail.com      | Daniil Chistoforov | –ê–¥–º–∏–Ω  | 3 –Ω–æ—è–±—Ä—è 2025 –≥.
–¥—Ä—É–≥–æ–π@email.com           | –ò–º—è              | [—Ä–æ–ª—å]  | –¥–∞—Ç–∞
```

## üõ† –ß—Ç–æ –±—ã–ª–æ –∏–∑–º–µ–Ω–µ–Ω–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏

### API –∫–æ–¥
```typescript
// –¢–µ–ø–µ—Ä—å –¥–µ–ª–∞–µ–º –¥–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞
const users = await supabase.from('users').select('*')
const psychologists = await supabase.from('psychologists').select('user_id, role, active')

// –°–æ–∑–¥–∞–µ–º Map –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
const psychologistMap = new Map(psychologists?.map(p => [p.user_id, p]))

// –û–±—ä–µ–¥–∏–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ users.sso_uid = psychologists.user_id
const usersWithRoles = users.map(user => ({
  ...user,
  effective_role: psychologistMap.get(user.sso_uid)?.role || user.subscription_tier
}))
```

### SQL
```sql
-- –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –Ω–∞–ª–∏—á–∏–µ –∑–∞–ø–∏—Å–∏ –∞–¥–º–∏–Ω–∞
INSERT INTO psychologists (user_id, email, full_name, role, active)
SELECT u.sso_uid, 'site4people@gmail.com', COALESCE(u.full_name, 'Admin'), 'admin', true
FROM users u WHERE u.email = 'site4people@gmail.com'
ON CONFLICT (email) DO UPDATE SET role = 'admin', active = true;

-- RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
CREATE POLICY "Admins can view all users" ON users FOR SELECT ...
CREATE POLICY "Admins can update all users" ON users FOR UPDATE ...
```

## üí° –í–∞–∂–Ω–æ

- –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL —Å–∫—Ä–∏–ø—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è **–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ**
- –ö–æ–¥ API —É–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω –∏ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—É—é –ª–æ–≥–∏–∫—É
- –ú–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –æ—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞ (Shift+F5) –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

---

**–ï—Å–ª–∏ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç** - –≤—ã —É–≤–∏–¥–∏—Ç–µ —Ä–æ–ª—å "–ê–¥–º–∏–Ω" –∏ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π! üéâ

