# üöÄ –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤ –∞–¥–º–∏–Ω–∫–µ

## –ß—Ç–æ —Å–ª—É—á–∏–ª–æ—Å—å?
‚úÖ –í—Å—è –º–µ—Ö–∞–Ω–∏–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ **–£–ñ–ï –†–ê–ë–û–¢–ê–ï–¢** –∫–∞–∫ –≤—ã –æ–ø–∏—Å–∞–ª–∏  
‚ùå –ù–æ –≤ –∞–¥–º–∏–Ω–∫–µ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∏–∑-–∑–∞ –æ–¥–Ω–æ–π –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏

## –ß—Ç–æ —è —Å–¥–µ–ª–∞–ª (—É–∂–µ –≥–æ—Ç–æ–≤–æ):
1. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏–ª API –∞–¥–º–∏–Ω–∫–∏ - —Ç–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
2. ‚úÖ –î–æ–±–∞–≤–∏–ª –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
3. ‚úÖ –°–æ–∑–¥–∞–ª –ø–æ–¥—Ä–æ–±–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

## –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –í–ê–ú (2 –º–∏–Ω—É—Ç—ã):

### –®–∞–≥ 1: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –≤ Supabase (1 –º–∏–Ω—É—Ç–∞)

#### –í–∞—Ä–∏–∞–Ω—Ç –ê: –ß–µ—Ä–µ–∑ Dashboard (–ü—Ä–æ—â–µ)
1. –û—Ç–∫—Ä–æ–π—Ç–µ https://supabase.com ‚Üí –≤–∞—à –ø—Ä–æ–µ–∫—Ç
2. –õ–µ–≤–æ–µ –º–µ–Ω—é ‚Üí **SQL Editor**
3. –ù–∞–∂–º–∏—Ç–µ **New Query**
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `supabase/migrations/025_fix_admin_analytics_access.sql`
5. –í—Å—Ç–∞–≤—å—Ç–µ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä
6. –ù–∞–∂–º–∏—Ç–µ **Run** (–∏–ª–∏ Ctrl+Enter)
7. –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è: `"Total policies created for monthly_analytics: 7"`

#### –í–∞—Ä–∏–∞–Ω—Ç –ë: –ß–µ—Ä–µ–∑ CLI
```bash
supabase db push
```

### –®–∞–≥ 2: –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è (1 –º–∏–Ω—É—Ç–∞)

```bash
# –î–æ–±–∞–≤–∏—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã
git add .

# –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å
git commit -m "Fix admin analytics display: update API logic and logging"

# –ó–∞–ø—É—à–∏—Ç—å
git push origin main

# –ï—Å–ª–∏ –∞–≤—Ç–æ–¥–µ–ø–ª–æ–π –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å –≤—Ä—É—á–Ω—É—é:
vercel --prod
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å (30 —Å–µ–∫—É–Ω–¥)

1. –û—Ç–∫—Ä–æ–π—Ç–µ –∞–¥–º–∏–Ω–∫—É: `https://–≤–∞—à-–¥–æ–º–µ–Ω.vercel.app/admin/users`
2. –í—ã–±–µ—Ä–∏—Ç–µ –ª—é–±–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∑–∞–ø–∏—Å—è–º–∏
3. **–°–ø—Ä–∞–≤–∞ –¥–æ–ª–∂–Ω–∞ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å—Å—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞** ‚úÖ

---

## –ì–æ—Ç–æ–≤–æ! üéâ

–¢–µ–ø–µ—Ä—å –≤ –∞–¥–º–∏–Ω–∫–µ –≤—ã —Å–º–æ–∂–µ—Ç–µ:
- ‚úÖ –í–∏–¥–µ—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É –∫–Ω–æ–ø–∫–æ–π "–ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏"
- ‚úÖ –û–±–Ω–æ–≤–ª—è—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∫–Ω–æ–ø–∫–æ–π "–û–±–Ω–æ–≤–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏"
- ‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ª—é–±—ã–µ –ø–æ–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ (–∫–Ω–æ–ø–∫–∞ –∫–∞—Ä–∞–Ω–¥–∞—à–∞)

---

## üìö –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ï—Å–ª–∏ –Ω—É–∂–Ω—ã –¥–µ—Ç–∞–ª–∏ –∏–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, —Å–º–æ—Ç—Ä–∏—Ç–µ:
- `–ö–†–ê–¢–ö–û–ï_–†–ï–ó–Æ–ú–ï_–ê–ù–ê–õ–ò–¢–ò–ö–ê.md` - –æ–±—â–∞—è –∫–∞—Ä—Ç–∏–Ω–∞ –º–µ—Ö–∞–Ω–∏–∫–∏
- `FIX_ADMIN_ANALYTICS_DISPLAY.md` - –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
- `ANALYTICS_CURRENT_STATE.md` - –ø–æ–ª–Ω—ã–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –æ–±–∑–æ—Ä

---

## üÜò –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–æ–±–ª–µ–º–∞: "Forbidden" –∏–ª–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è 025 –ø—Ä–∏–º–µ–Ω–µ–Ω–∞:
   ```sql
   SELECT COUNT(*) FROM pg_policies 
   WHERE tablename = 'monthly_analytics';
   -- –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å: 7
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤—ã –∞–¥–º–∏–Ω:
   ```sql
   SELECT * FROM psychologists 
   WHERE role = 'admin' AND active = true;
   ```

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ Vercel:
   - `PERPLEXITY_API_KEY` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å –∑–∞–ø–∏—Å–∏ —Å `mood_score`

### –ü—Ä–æ–±–ª–µ–º–∞: –ß—Ç–æ-—Ç–æ –¥—Ä—É–≥–æ–µ

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Vercel:**
   - Dashboard ‚Üí Functions ‚Üí Logs
   - –ù–∞–π–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è `[Admin Analytics GET]` –∏–ª–∏ `[Admin Analytics Generate]`
   - –¢–∞–º –±—É–¥–µ—Ç –≤–∏–¥–Ω–æ –≥–¥–µ –∏–º–µ–Ω–Ω–æ –æ—à–∏–±–∫–∞

2. **–ù–∞–ø–∏—à–∏—Ç–µ –º–Ω–µ!** –ü—Ä–∏—à–ª–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç –æ—à–∏–±–∫–∏ –∏–∑ –ª–æ–≥–æ–≤.

---

## ‚ú® –ë–æ–Ω—É—Å: –ß—Ç–æ –µ—â–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∫—Ä–æ–Ω ‚è∞
- –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è **–∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 22:00 UTC**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–æ–π
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫—É –∫–∞–∂–¥—ã–µ 7 –¥–Ω–µ–π –∏–ª–∏ –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å –º–µ—Å—è—Ü–∞

### –ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ üìà
- –î–µ–Ω—å 7: –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 7 –¥–Ω–µ–π ‚Üí 1 –Ω–µ–¥–µ–ª—è
- –î–µ–Ω—å 14: –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 14 –¥–Ω–µ–π ‚Üí 2 –Ω–µ–¥–µ–ª–∏
- –î–µ–Ω—å 21: –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 21 –¥–µ–Ω—å ‚Üí 3 –Ω–µ–¥–µ–ª–∏
- –ü–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å: –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤–µ—Å—å –º–µ—Å—è—Ü ‚Üí —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

### API Perplexity ü§ñ
- –ú–æ–¥–µ–ª—å: `sonar-pro`
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç –ø–æ 5 —Ä–∞–∑–¥–µ–ª–∞–º
- –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞ –ø–æ markdown –∑–∞–≥–æ–ª–æ–≤–∫–∞–º
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑—É —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏

---

## üìä –ò—Ç–æ–≥

**–õ–∏—à–Ω–µ–≥–æ –∫–æ–¥–∞ –ù–ï–¢!** –í—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –Ω–∞–¥–æ, –ø—Ä–æ—Å—Ç–æ –Ω—É–∂–Ω–æ –±—ã–ª–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –æ–¥–Ω—É –º–∏–≥—Ä–∞—Ü–∏—é. üöÄ
