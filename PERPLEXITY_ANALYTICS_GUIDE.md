# üìä –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ú–µ—Å—è—á–Ω–æ–π –ê–Ω–∞–ª–∏—Ç–∏–∫–µ —Å Perplexity AI

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –º–µ—Å—è—á–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ø–æ–º–æ—â—å—é Perplexity AI –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞.

## üéØ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ú–µ—Ö–∞–Ω–∏–∫–∞ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

1. **–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è**: –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∫–∞–∂–¥—É—é –Ω–µ–¥–µ–ª—é (–∫–∞–∂–¥—ã–µ 7 –¥–Ω–µ–π)
2. **–ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–∏–Ω—Ü–∏–ø**: 
   - 1-—è –Ω–µ–¥–µ–ª—è: –∞–Ω–∞–ª–∏–∑ –∑–∞ 7 –¥–Ω–µ–π
   - 2-—è –Ω–µ–¥–µ–ª—è: –∞–Ω–∞–ª–∏–∑ –∑–∞ 14 –¥–Ω–µ–π (–Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–æ)
   - 3-—è –Ω–µ–¥–µ–ª—è: –∞–Ω–∞–ª–∏–∑ –∑–∞ 21 –¥–µ–Ω—å (–Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–æ)
   - 4-—è –Ω–µ–¥–µ–ª—è –∏ –¥–∞–ª–µ–µ: –∞–Ω–∞–ª–∏–∑ –∑–∞ –≤—Å–µ –¥–Ω–∏ –º–µ—Å—è—Ü–∞
3. **–§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç**: –í –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å –º–µ—Å—è—Ü–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞, –∫–æ—Ç–æ—Ä–∞—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞–≤—Å–µ–≥–¥–∞

### –ß—Ç–æ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è:
- üå°Ô∏è –û—Ü–µ–Ω–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è (1-5)
- üí≠ –¢–µ–∫—Å—Ç–æ–≤–∞—è –∑–∞–ø–∏—Å—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- üîñ –§–∞–∫—Ç–æ—Ä—ã, –≤–ª–∏—è—é—â–∏–µ –Ω–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `monthly_analytics`

```sql
CREATE TABLE monthly_analytics (
  id UUID PRIMARY KEY,
  user_id UUID NOT NULL,
  year INTEGER NOT NULL,
  month INTEGER NOT NULL,
  week_number INTEGER NOT NULL,      -- –ù–æ–º–µ—Ä –Ω–µ–¥–µ–ª–∏ (1, 2, 3, 4)
  days_analyzed INTEGER NOT NULL,     -- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–Ω–µ–π
  
  -- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑
  analysis_text TEXT NOT NULL,        -- –ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –∞–Ω–∞–ª–∏–∑–∞
  general_impression TEXT,            -- –û–±—â–µ–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ –æ –ø–µ—Ä–∏–æ–¥–µ
  positive_trends TEXT,               -- –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ–Ω–¥–µ–Ω—Ü–∏–∏
  decline_reasons TEXT,               -- –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã —Å–ø–∞–¥–∞
  recommendations TEXT,               -- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∏ —Ç–µ—Ö–Ω–∏–∫–∏
  reflection_directions TEXT,         -- –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏–π
  
  is_final BOOLEAN DEFAULT false,     -- true –¥–ª—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –¥–Ω—è –º–µ—Å—è—Ü–∞
  status TEXT DEFAULT 'completed',
  created_at TIMESTAMP DEFAULT NOW()
);
```

## üîÑ API Endpoints

### 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

**POST** `/api/analytics/generate`

```typescript
// Request
{
  year?: number,  // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ç–µ–∫—É—â–∏–π –≥–æ–¥
  month?: number  // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü (1-12)
}

// Response
{
  success: true,
  analytics: { /* MonthlyAnalytics object */ },
  weekNumber: 2,
  daysAnalyzed: 14,
  isFinal: false
}
```

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

**GET** `/api/analytics?year=2024&month=11`

```typescript
// Response
{
  hasAnalytics: true,
  analytics: {
    id: "uuid",
    year: 2024,
    month: 11,
    week_number: 2,
    days_analyzed: 14,
    general_impression: "...",
    positive_trends: "...",
    decline_reasons: "...",
    recommendations: "...",
    reflection_directions: "...",
    is_final: false
  },
  isFinal: false
}
```

### 3. Cron Job (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π)

**GET** `/api/cron/monthly-analytics`

–ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 22:00 UTC —á–µ—Ä–µ–∑ Vercel Cron.

## üé® UI –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### –ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π

–ë–ª–æ–∫ "–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏" –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—è:

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫—É –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
- üîÑ –ö–Ω–æ–ø–∫–∞ "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å" –¥–ª—è —Ä—É—á–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–µ–∫—Ü–∏–π –∞–Ω–∞–ª–∏–∑–∞
- üéØ –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –º–µ—Å—è—Ü–∞
- üîÑ –ö–Ω–æ–ø–∫–∞ "–û–±–Ω–æ–≤–∏—Ç—å" –¥–ª—è –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –º–µ—Å—è—Ü–µ–≤

### –†–∞–∑–¥–µ–ª—ã –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

1. **–û–±—â–µ–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ –æ –ø–µ—Ä–∏–æ–¥–µ** - –æ–±–∑–æ—Ä —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
2. **‚ú® –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ–Ω–¥–µ–Ω—Ü–∏–∏** - —á—Ç–æ –∏–¥–µ—Ç —Ö–æ—Ä–æ—à–æ
3. **üîç –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã —Å–ø–∞–¥–∞** - –∞–Ω–∞–ª–∏–∑ —Ç—Ä—É–¥–Ω–æ—Å—Ç–µ–π –±–µ–∑ –∫—Ä–∏—Ç–∏–∫–∏
4. **üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∏ —Ç–µ—Ö–Ω–∏–∫–∏** - –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã
5. **üéØ –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏–π** - —Ç–µ–º—ã –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–±–æ—Ç—ã

## ü§ñ Perplexity Integration

### –ü—Ä–æ–º–ø—Ç-–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π:
- –ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç AI –∫–∞–∫ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –ø—Å–∏—Ö–æ–ª–æ–≥–∞
- –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø–æ 5 –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- –í–∫–ª—é—á–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è (–Ω–æ–º–µ—Ä –Ω–µ–¥–µ–ª–∏, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π)
- –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∑–∞–ø–∏—Å–∏ —Å –¥–∞—Ç–∞–º–∏, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ–º –∏ —Ñ–∞–∫—Ç–æ—Ä–∞–º–∏

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã API

```typescript
{
  model: 'sonar-pro',
  temperature: 0.7,
  max_tokens: 3000
}
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
PERPLEXITY_API_KEY=pplx-your-api-key
CRON_SECRET=your-cron-secret  # –î–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ cron endpoints
```

### 2. Vercel Cron Setup

–í `vercel.json`:

```json
{
  "crons": [
    {
      "path": "/api/cron/monthly-analytics",
      "schedule": "0 22 * * *"  // –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 22:00 UTC
    }
  ]
}
```

### 3. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ (—Å Supabase CLI)
supabase migration up

# –ò–ª–∏ –≤ Supabase Dashboard
# SQL Editor -> –í—Å—Ç–∞–≤–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ 024_create_monthly_analytics.sql -> Run
```

## üìù –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (Cron)

```
–ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 22:00 UTC:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–æ–π
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
   - –í—ã—á–∏—Å–ª–∏—Ç—å —Ç–µ–∫—É—â—É—é –Ω–µ–¥–µ–ª—é –º–µ—Å—è—Ü–∞
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω—É–∂–Ω–æ –ª–∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å (–∫–∞–∂–¥—ã–µ 7 –¥–Ω–µ–π –∏–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å)
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∂–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∑–∞ —ç—Ç—É –Ω–µ–¥–µ–ª—é
   - –ï—Å–ª–∏ –Ω–µ—Ç - —Å–æ–±—Ä–∞—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏ –º–µ—Å—è—Ü–∞ –¥–æ —Ç–µ–∫—É—â–µ–≥–æ –¥–Ω—è
   - –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Perplexity –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –ë–î
```

### –†—É—á–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—Ä—É—á–Ω—É—é –∑–∞–ø—Ä–æ—Å–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:
- –ö–Ω–æ–ø–∫–∞ "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å" –ø–æ—è–≤–ª—è–µ—Ç—Å—è, –µ—Å–ª–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –µ—â–µ –Ω–µ—Ç
- –ö–Ω–æ–ø–∫–∞ "–û–±–Ω–æ–≤–∏—Ç—å" –ø–æ—è–≤–ª—è–µ—Ç—Å—è –¥–ª—è –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –º–µ—Å—è—Ü–µ–≤
- –î–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∫–Ω–æ–ø–∫–∞ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### RLS Policies

```sql
-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É
CREATE POLICY "Users can read their own monthly analytics"
  ON monthly_analytics FOR SELECT
  USING (auth.uid() = user_id);

-- –ê–¥–º–∏–Ω—ã –≤–∏–¥—è—Ç –≤—Å—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É
CREATE POLICY "Admins can read all monthly analytics"
  ON monthly_analytics FOR SELECT
  USING (EXISTS (
    SELECT 1 FROM psychologists
    WHERE user_id = auth.uid() AND role = 'admin'
  ));
```

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

1. –ó–∞–ø–æ–ª–Ω—è–π—Ç–µ –¥–Ω–µ–≤–Ω–∏–∫ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å
2. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –±—É–¥–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—É—é –Ω–µ–¥–µ–ª—é
3. –°–º–æ—Ç—Ä–∏—Ç–µ –∞–Ω–∞–ª–∏—Ç–∏–∫—É –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—è
4. –í –∫–æ–Ω—Ü–µ –º–µ—Å—è—Ü–∞ –ø–æ–ª—É—á–∏—Ç–µ —Ñ–∏–Ω–∞–ª—å–Ω—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É
5. –ü—Ä–∏ —Å–º–µ–Ω–µ –º–µ—Å—è—Ü–∞ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ —É–≤–∏–¥–∏—Ç–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

```bash
# –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ cron (–ª–æ–∫–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
curl -X GET http://localhost:3000/api/cron/monthly-analytics \
  -H "Authorization: Bearer YOUR_CRON_SECRET"

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
curl -X POST http://localhost:3000/api/analytics/generate \
  -H "Authorization: Bearer USER_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"year": 2024, "month": 11}'
```

## üéØ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑

- –ö–∞–∂–¥–∞—è –Ω–æ–≤–∞—è –Ω–µ–¥–µ–ª—è –≤–∫–ª—é—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤—Å–µ—Ö –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –¥–Ω–µ–π –º–µ—Å—è—Ü–∞
- Perplexity –ø–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–æ–º–µ—Ä–µ –Ω–µ–¥–µ–ª–∏ –≤ –ø—Ä–æ–º–ø—Ç–µ
- –ê–Ω–∞–ª–∏–∑ —É—á–∏—Ç—ã–≤–∞–µ—Ç –¥–∏–Ω–∞–º–∏–∫—É –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Ç–µ—á–µ–Ω–∏–µ –º–µ—Å—è—Ü–∞

### –§–∏–Ω–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å –º–µ—Å—è—Ü–∞
- –ü–æ–º–µ—á–∞–µ—Ç—Å—è —Ñ–ª–∞–≥–æ–º `is_final = true`
- –ù–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∞ (–∫–Ω–æ–ø–∫–∞ "–û–±–Ω–æ–≤–∏—Ç—å" —Å–∫—Ä—ã—Ç–∞)
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞–≤—Å–µ–≥–¥–∞ –¥–ª—è –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

- SWR –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
- –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- –ú–∏–Ω–∏–º—É–º 3 –∑–∞–ø–∏—Å–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

## üìä –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ –∫ Perplexity

```
–î–∞–Ω–Ω—ã–µ –∑–∞ 14 –¥–Ω–µ–π (2-—è –Ω–µ–¥–µ–ª—è –º–µ—Å—è—Ü–∞):

üìÖ 2024-11-01
üå°Ô∏è –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ: –•–æ—Ä–æ—à–æ (4/5)
üí≠ –ó–∞–ø–∏—Å—å: –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ã–π –¥–µ–Ω—å –Ω–∞ —Ä–∞–±–æ—Ç–µ...
üîñ –§–∞–∫—Ç–æ—Ä—ã: –†–∞–±–æ—Ç–∞, –°–µ–º—å—è

---

üìÖ 2024-11-02
üå°Ô∏è –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ: –û—Ç–ª–∏—á–Ω–æ (5/5)
üí≠ –ó–∞–ø–∏—Å—å: –í—Å—Ç—Ä–µ—á–∞ —Å –¥—Ä—É–∑—å—è–º–∏...
üîñ –§–∞–∫—Ç–æ—Ä—ã: –î—Ä—É–∑—å—è, –î–æ—Å—É–≥

...
```

### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞

```markdown
## –û–±—â–µ–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ –æ –ø–µ—Ä–∏–æ–¥–µ
–ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–≤–µ –Ω–µ–¥–µ–ª–∏ –≤–∞—à–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—É—é –¥–∏–Ω–∞–º–∏–∫—É...

## –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ–Ω–¥–µ–Ω—Ü–∏–∏
- –°—Ç–∞–±–∏–ª—å–Ω–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –≤ —Ä–∞–±–æ—á–∏–µ –¥–Ω–∏
- –ê–∫—Ç–∏–≤–Ω–∞—è —Å–æ—Ü–∏–∞–ª—å–Ω–∞—è –∂–∏–∑–Ω—å...

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã —Å–ø–∞–¥–∞
...

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∏ —Ç–µ—Ö–Ω–∏–∫–∏
1. –¢–µ—Ö–Ω–∏–∫–∞ "5-4-3-2-1" –¥–ª—è –∑–∞–∑–µ–º–ª–µ–Ω–∏—è...
2. –ü—Ä–∞–∫—Ç–∏–∫–∞ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥ —Å–Ω–æ–º...

## –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏–π
...
```

## üêõ Troubleshooting

### –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ PERPLEXITY_API_KEY –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç –∞–∫—Ç–∏–≤–Ω—É—é –ø–æ–¥–ø–∏—Å–∫—É
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –µ—Å—Ç—å –ª–∏ —Ö–æ—Ç—è –±—ã 3 –∑–∞–ø–∏—Å–∏ –∑–∞ –º–µ—Å—è—Ü
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Vercel Functions

### Cron –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫—É cron –≤ vercel.json
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–æ–µ–∫—Ç –¥–µ–ø–ª–æ–∏—Ç—Å—è –Ω–∞ Vercel
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Vercel Dashboard -> Cron Jobs

### –û—à–∏–±–∫–∏ RLS

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è 024 –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω
3. –î–ª—è –∞–¥–º–∏–Ω–æ–≤ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ psychologists

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Perplexity API Documentation](https://docs.perplexity.ai/)
- [Vercel Cron Jobs](https://vercel.com/docs/cron-jobs)
- [Supabase RLS](https://supabase.com/docs/guides/auth/row-level-security)
- [date-fns Documentation](https://date-fns.org/)

## üéâ –ì–æ—Ç–æ–≤–æ!

–°–∏—Å—Ç–µ–º–∞ –º–µ—Å—è—á–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞—Ç—å –≥–ª—É–±–æ–∫–∏–π –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Å–≤–æ–µ–≥–æ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–∞–∂–¥—É—é –Ω–µ–¥–µ–ª—é —Å –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö –≤–Ω—É—Ç—Ä–∏ –º–µ—Å—è—Ü–∞.


