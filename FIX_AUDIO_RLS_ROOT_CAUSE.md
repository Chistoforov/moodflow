# üîß –ö–æ—Ä–Ω–µ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã RLS –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∞—É–¥–∏–æ

## üéØ –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞

–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ **—Ä–∞–∑–Ω–∏—Ü–µ –ø–æ–¥—Ö–æ–¥–æ–≤** –∫ RLS –ø–æ–ª–∏—Ç–∏–∫–∞–º:

- ‚úÖ **`daily_entries`** (–º–∏–≥—Ä–∞—Ü–∏—è 008) - —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ:
  - `user_id` —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ `users.id`
  - –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —á–µ—Ä–µ–∑ —Ç–∞–±–ª–∏—Ü—É `users` –∏ `sso_uid`
  - –ü—Ä—è–º–æ–π INSERT —Ä–∞–±–æ—Ç–∞–µ—Ç!

- ‚ùå **`audio_entries`** (–º–∏–≥—Ä–∞—Ü–∏—è 009) - –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–æ:
  - `user_id` —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ `auth.users(id)` –Ω–∞–ø—Ä—è–º—É—é
  - –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä—è–ª–∞ —á–µ—Ä–µ–∑ `auth.uid()` –Ω–∞–ø—Ä—è–º—É—é
  - `auth.uid()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç NULL –≤ —Å–µ—Ä–≤–µ—Ä–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ API routes
  - –ü—Ä—è–º–æ–π INSERT –Ω–µ —Ä–∞–±–æ—Ç–∞–ª!

## ‚úÖ –†–µ—à–µ–Ω–∏–µ: –ú–∏–≥—Ä–∞—Ü–∏—è 014

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç **—Ç–æ—Ç –∂–µ –ø–æ–¥—Ö–æ–¥, —á—Ç–æ –∏ `daily_entries`**:
- –§—É–Ω–∫—Ü–∏—è `user_owns_audio_entry` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —á–µ—Ä–µ–∑ —Ç–∞–±–ª–∏—Ü—É `users` –∏ `sso_uid`
- –≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ—Ç–æ–º—É —á—Ç–æ `users.sso_uid` = `auth.users.id`
- –ü—Ä—è–º–æ–π INSERT —Ç–µ–ø–µ—Ä—å –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å!

## üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –®–∞–≥ 1: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é 014

1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard: https://supabase.com/dashboard
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **SQL Editor**
4. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π query –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å –∫–æ–¥ –∏–∑ —Ñ–∞–π–ª–∞:
   ```
   supabase/migrations/014_fix_audio_entries_rls_like_daily.sql
   ```
5. –ù–∞–∂–º–∏—Ç–µ **Run** –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∞—É–¥–∏–æ —Å–Ω–æ–≤–∞. –û—à–∏–±–∫–∞ –¥–æ–ª–∂–Ω–∞ –∏—Å—á–µ–∑–Ω—É—Ç—å.

## üîç –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

1. **–§—É–Ω–∫—Ü–∏—è `user_owns_audio_entry`**:
   - –¢–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —á–µ—Ä–µ–∑ —Ç–∞–±–ª–∏—Ü—É `users` –∏ `sso_uid` (–∫–∞–∫ `daily_entries`)
   - –í–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ `auth.uid() = entry_user_id`
   - –≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ—Ç–æ–º—É —á—Ç–æ `users.sso_uid` = `auth.users.id`

2. **–ö–æ–¥ API route**:
   - –í–µ—Ä–Ω—É–ª–∏ –ø—Ä–æ—Å—Ç–æ–π INSERT (–∫–∞–∫ –≤ `entries/route.ts`)
   - –£–±—Ä–∞–ª–∏ —Å–ª–æ–∂–Ω—É—é –ª–æ–≥–∏–∫—É —Å RPC —Ñ—É–Ω–∫—Ü–∏–µ–π
   - –¢–µ–ø–µ—Ä—å –∫–æ–¥ –∏–¥–µ–Ω—Ç–∏—á–µ–Ω —Ä–∞–±–æ—á–µ–º—É `entries/route.ts`

## üí° –ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

- `daily_entries` —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ç–µ–º –∂–µ –ø–æ–¥—Ö–æ–¥–æ–º
- `audio_entries` —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ—Ç –∂–µ –ø–æ–¥—Ö–æ–¥
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ —Ç–∞–±–ª–∏—Ü—É `users` —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Å–µ—Ä–≤–µ—Ä–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
- –ü—Ä—è–º–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ `auth.uid()` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Å–µ—Ä–≤–µ—Ä–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ

## ‚ö†Ô∏è –í–∞–∂–Ω–æ:

1. **–ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é 014** - —ç—Ç–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
2. –ö–æ–¥ —É–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ
3. –ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—Å–µ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å
4. –ë–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å RPC —Ñ—É–Ω–∫—Ü–∏–∏ –∏–ª–∏ –æ–±—Ö–æ–¥–Ω—ã–µ –ø—É—Ç–∏

## üöÄ –†–µ–∑—É–ª—å—Ç–∞—Ç:

- ‚úÖ –ö–æ–¥ –ø—Ä–æ—Å—Ç–æ–π –∏ –ø–æ–Ω—è—Ç–Ω—ã–π (–∫–∞–∫ `entries/route.ts`)
- ‚úÖ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å —Ç–∏–ø–∞–º–∏ TypeScript
- ‚úÖ –î–µ–ø–ª–æ–π –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ –∞—É–¥–∏–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

