# üîß –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ 015 –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è RLS

## ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∞—É–¥–∏–æ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –æ—à–∏–±–∫–∞: **"new row violates row-level security policy"**

## ‚úÖ –†–µ—à–µ–Ω–∏–µ
–ù—É–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é 015, –∫–æ—Ç–æ—Ä–∞—è –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è `audio_entries`.

---

## üìã –®–∞–≥–∏ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏

### –®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://supabase.com/dashboard
2. –í–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç
3. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç **MoodFlow**

### –®–∞–≥ 2: –û—Ç–∫—Ä–æ–π—Ç–µ SQL Editor

1. –í –ª–µ–≤–æ–º –º–µ–Ω—é –Ω–∞–π–¥–∏—Ç–µ —Ä–∞–∑–¥–µ–ª **SQL Editor**
2. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–µ–≥–æ
3. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **"New query"** (–ù–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å)

### –®–∞–≥ 3: –°–∫–æ–ø–∏—Ä—É–π—Ç–µ SQL –∫–æ–¥

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª: `supabase/migrations/015_fix_audio_rls_final.sql`
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **–≤–µ—Å—å** –∫–æ–¥ –∏–∑ —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞
3. –í—Å—Ç–∞–≤—å—Ç–µ –∫–æ–¥ –≤ SQL Editor –≤ Supabase Dashboard

### –®–∞–≥ 4: –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é

1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **"Run"** (–∏–ª–∏ Ctrl+Enter / Cmd+Enter)
2. –î–æ–∂–¥–∏—Ç–µ—Å—å —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
3. –í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ (Success)

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É

1. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ MoodFlow
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∞—É–¥–∏–æ–∑–∞–ø–∏—Å—å —Å–Ω–æ–≤–∞
3. –û—à–∏–±–∫–∞ –¥–æ–ª–∂–Ω–∞ –∏—Å—á–µ–∑–Ω—É—Ç—å! ‚ú®

---

## üîç –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —ç—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏—è?

–ú–∏–≥—Ä–∞—Ü–∏—è 015 –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç RLS (Row Level Security) –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `audio_entries`:

1. **–°–æ–∑–¥–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é** `user_owns_audio_entry()` –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∑–∞–ø–∏—Å–∏
2. **–£–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ** –Ω–µ—Ä–∞–±–æ—Ç–∞—é—â–∏–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏
3. **–°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–µ** RLS –ø–æ–ª–∏—Ç–∏–∫–∏, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É –ø—Ä–æ–≤–µ—Ä–∫–∏
4. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç **—Ç–æ—Ç –∂–µ –ø–æ–¥—Ö–æ–¥**, —á—Ç–æ –∏ –¥–ª—è `daily_entries` (–∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç)

---

## üí° –ü–æ—á–µ–º—É –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –ø–æ–ø—ã—Ç–∫–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∏?

- –¢–∞–±–ª–∏—Ü–∞ `audio_entries` –∏–º–µ–µ—Ç `user_id` –∫–æ—Ç–æ—Ä—ã–π —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ `auth.users(id)` –Ω–∞–ø—Ä—è–º—É—é
- –í API routes —Ñ—É–Ω–∫—Ü–∏—è `auth.uid()` –º–æ–∂–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å NULL –∏–∑-–∑–∞ —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —á–µ—Ä–µ–∑ —Ç–∞–±–ª–∏—Ü—É `public.users` –∏ –ø–æ–ª–µ `sso_uid`
- –≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ—Ç–æ–º—É —á—Ç–æ `users.sso_uid = auth.users.id`

---

## ‚ùì –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫

–ï—Å–ª–∏ –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—Å–µ –µ—â–µ –µ—Å—Ç—å –æ—à–∏–±–∫–∞:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ Supabase Dashboard ‚Üí **Database** ‚Üí **Tables** ‚Üí `audio_entries`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ RLS –≤–∫–ª—é—á–µ–Ω (Row Level Security = Enabled)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ policies (–ø–æ–ª–∏—Ç–∏–∫–∏) - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å 4 –ø–æ–ª–∏—Ç–∏–∫–∏ —Å –∏–º–µ–Ω–∞–º–∏:
   - "Users can view their own audio entries"
   - "Users can insert their own audio entries"
   - "Users can update their own audio entries"
   - "Users can delete their own audio entries"

–ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å - –Ω–∞–ø–∏—à–∏—Ç–µ –º–Ω–µ!

---

## üöÄ –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ –∞—É–¥–∏–æ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –æ—à–∏–±–æ–∫  
‚úÖ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ  
‚úÖ –ö–æ–¥ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –ø—Ä–æ—Å—Ç—ã–º –∏ –ø–æ–Ω—è—Ç–Ω—ã–º  
‚úÖ –ë–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω—ã –æ–±—Ö–æ–¥–Ω—ã–µ –ø—É—Ç–∏ –∏–ª–∏ RPC —Ñ—É–Ω–∫—Ü–∏–∏  

–£–¥–∞—á–∏! üéâ

